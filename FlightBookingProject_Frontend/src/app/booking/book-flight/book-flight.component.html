<div class="container">
  <div class="booking-page">
    <h1>Book Your Flight</h1>
    
    <div *ngIf="loadingFlight" class="loading">
      <p>Loading flight details...</p>
    </div>

    <div *ngIf="!loadingFlight && flight" class="booking-content">
      <!-- Flight Summary -->
      <div class="card flight-summary">
        <h2>Flight Details</h2>
        <div class="flight-info">
          <div class="info-row">
            <span class="info-label">Flight:</span>
            <span class="info-value">{{ flight.airline }} {{ flight.flightNumber }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Route:</span>
            <span class="info-value">{{ flight.source }} → {{ flight.destination }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Departure:</span>
            <span class="info-value">{{ formatDateTime(flight.departureTime) }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Arrival:</span>
            <span class="info-value">{{ formatDateTime(flight.arrivalTime) }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Available Seats:</span>
            <span class="info-value">{{ flight.availableSeats }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Price per seat:</span>
            <span class="info-value">₹{{ flight.price }}</span>
          </div>
        </div>
      </div>

      <!-- Booking Form -->
      <div class="card booking-form-card">
        <h2>Passenger Details</h2>
        <form (ngSubmit)="onBookFlight()" class="booking-form">
          <div class="form-group">
            <label class="form-label" for="tripType">Trip Type</label>
            <select 
              id="tripType" 
              class="form-input" 
              [(ngModel)]="bookingData.tripType"
              name="tripType"
              (change)="onTripTypeChange()"
              required
            >
              <option value="ONE_WAY">One Way</option>
              <option value="ROUND_TRIP">Round Trip</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label" for="travelDate">Travel Date</label>
            <input 
              type="date" 
              id="travelDate" 
              class="form-input" 
              [(ngModel)]="bookingData.travelDate"
              name="travelDate"
              (change)="onTravelDateChange()"
              [min]="today"
              [readonly]="travelDateFromSearch"
              [class.readonly-field]="travelDateFromSearch"
              required
            />
            <small *ngIf="travelDateFromSearch" class="form-hint">
              Travel date from your search
            </small>
          </div>

          <div class="form-group">
            <label class="form-label" for="seats">Number of Seats</label>
            <input 
              type="number" 
              id="seats" 
              class="form-input" 
              [(ngModel)]="bookingData.seatsBooked"
              name="seats"
              min="1"
              [max]="flight.availableSeats"
              (change)="updatePassengers()"
              required
            />
          </div>

          <div class="form-group">
            <label class="form-label" for="contactEmail">Contact Email</label>
            <input 
              type="email" 
              id="contactEmail" 
              class="form-input" 
              [(ngModel)]="bookingData.contactEmail"
              name="contactEmail"
              placeholder="your.email@example.com"
              required
            />
          </div>

          <!-- Return Flight (if round trip) -->
          <div *ngIf="bookingData.tripType === 'ROUND_TRIP'" class="return-flight-section">
            <h3>Return Flight</h3>
            <div class="form-group">
              <label class="form-label" for="returnFlightNumber">Return Flight Number</label>
              <input 
                type="text" 
                id="returnFlightNumber" 
                class="form-input" 
                [(ngModel)]="bookingData.returnFlightNumber"
                name="returnFlightNumber"
                (change)="onReturnFlightChange()"
                placeholder="e.g., UK-124"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label" for="returnTravelDate">Return Travel Date</label>
              <input 
                type="date" 
                id="returnTravelDate" 
                class="form-input" 
                [(ngModel)]="bookingData.returnTravelDate"
                name="returnTravelDate"
                (change)="onReturnDateChange()"
                [min]="bookingData.travelDate"
                required
              />
            </div>
          </div>

          <!-- Passengers -->
          <div class="passengers-section">
            <h3>Passenger Information</h3>
            <div *ngFor="let passenger of bookingData.passengers; let i = index" class="passenger-card">
              <h4>Passenger {{ i + 1 }}</h4>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Name</label>
                  <input 
                    type="text" 
                    class="form-input" 
                    [(ngModel)]="passenger.name"
                    [name]="'passengerName' + i"
                    placeholder="Full name"
                    required
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Seat Number</label>
                  <select 
                    class="form-input" 
                    [(ngModel)]="passenger.seatNumber"
                    [name]="'seatNumber' + i"
                    (change)="loadAvailableSeats()"
                    required
                  >
                    <option value="">Select seat</option>
                    <option *ngFor="let seat of getAvailableSeatsForPassenger(i)" [value]="seat">{{ seat }}</option>
                  </select>
                  <small *ngIf="availableSeats.length === 0 && bookingData.travelDate" class="form-hint error">
                    No seats available. Please select a different date.
                  </small>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Gender</label>
                  <select 
                    class="form-input" 
                    [(ngModel)]="passenger.gender"
                    [name]="'gender' + i"
                    required
                  >
                    <option value="">Select</option>
                    <option value="MALE">Male</option>
                    <option value="FEMALE">Female</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Meal Type</label>
                  <select 
                    class="form-input" 
                    [(ngModel)]="passenger.mealType"
                    [name]="'mealType' + i"
                    required
                  >
                    <option value="">Select</option>
                    <option value="VEG">Vegetarian</option>
                    <option value="NON_VEG">Non-Vegetarian</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Return Passengers (if round trip) -->
            <div *ngIf="bookingData.tripType === 'ROUND_TRIP'" class="return-passengers-section">
              <h3>Return Flight Passengers</h3>
              <div *ngFor="let passenger of bookingData.returnPassengers; let i = index" class="passenger-card">
                <h4>Passenger {{ i + 1 }} - Return</h4>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Name</label>
                    <input 
                      type="text" 
                      class="form-input" 
                      [(ngModel)]="passenger.name"
                      [name]="'returnPassengerName' + i"
                      [value]="bookingData.passengers[i].name"
                      readonly
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Seat Number</label>
                    <select 
                      class="form-input" 
                      [(ngModel)]="passenger.seatNumber"
                      [name]="'returnSeatNumber' + i"
                      required
                    >
                      <option value="">Select seat</option>
                      <option *ngFor="let seat of returnAvailableSeats" [value]="seat">{{ seat }}</option>
                    </select>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Gender</label>
                    <select 
                      class="form-input" 
                      [(ngModel)]="passenger.gender"
                      [name]="'returnGender' + i"
                      [value]="bookingData.passengers[i].gender"
                      readonly
                    >
                      <option [value]="bookingData.passengers[i].gender">{{ bookingData.passengers[i].gender }}</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Meal Type</label>
                    <select 
                      class="form-input" 
                      [(ngModel)]="passenger.mealType"
                      [name]="'returnMealType' + i"
                      [value]="bookingData.passengers[i].mealType"
                      readonly
                    >
                      <option [value]="bookingData.passengers[i].mealType">{{ bookingData.passengers[i].mealType }}</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="booking-summary">
            <div class="summary-row">
              <span>Total Passengers:</span>
              <span>{{ bookingData.seatsBooked }}</span>
            </div>
            <div class="summary-row">
              <span>Price per seat:</span>
              <span>₹{{ flight.price }}</span>
            </div>
            <div class="summary-row total">
              <span>Total Amount:</span>
              <span>₹{{ flight.price * bookingData.seatsBooked }}</span>
            </div>
          </div>

          <button type="submit" class="btn-primary" [disabled]="loading">
            {{ loading ? 'Booking...' : 'Confirm Booking' }}
          </button>

          <div *ngIf="errorMessage" class="error-message">
            {{ errorMessage }}
          </div>
          <div *ngIf="successMessage" class="success-message">
            {{ successMessage }}
          </div>
        </form>
      </div>
    </div>

    <div *ngIf="!loadingFlight && !flight" class="error-message">
      Flight not found. Please go back and search again.
    </div>
  </div>
</div>
